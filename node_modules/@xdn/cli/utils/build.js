"use strict";

const logo = require('./logo');

const getEntryPoint = require('./getEntryPoint');

const chalk = require('chalk');

module.exports = async function build({
  context,
  skipFramework,
  disablePermanentAssets,
  includeSources
}) {
  process.env.NODE_ENV = 'production';
  const {
    logger
  } = context;

  if (includeSources) {
    process.env.XDN_INCLUDE_SOURCES = 'true'; // see DeploymentBuilder#build
  }

  if (disablePermanentAssets) {
    console.log(`> XDN permanent asset storage is ${chalk.red('disabled')}.`);
    process.env.XDN_DISABLE_PERMANENT_ASSETS = 'true'; // see DeploymentBuilder#addStaticAsset
  }

  await logger.step(`🛠️  Building your app for deployment on the ${logo}`, async () => {
    const build = await getEntryPoint('build');
    await build({
      skipFramework
    });
  });
};